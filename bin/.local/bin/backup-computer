#!/usr/bin/env bash

networkName=$(iwgetid -r)

if [[ -z $networkName && ${networkName+x} ]];
then
    echo "Connect to Wi-Fi to backup computer"
    notify-send "Connect to Wi-Fi to backup computer"
    exit 0
fi

filesInServerFolder=$(ls /mnt/server | wc -l)

if [[ $filesInServerFolder -le 1 ]]; then
    echo "Not mounted to server"
    notify-send "Not mounted to server"
    exit 0
fi

notify-send "Starting to backup computer to server"

backupDate=$(date +%b-%d-%y)
backupPath="/mnt/server/backups/$backupDate"
mkdir $backupPath

sudo tar --exclude="**/node_modules/*" --exclude=".*" --exclude="sky.tar.gz" --exclude="**/target/*" --exclude="**/Movies/*" --exclude="**/__pycache__/*" -zcvf /home/sky/sky.tar.gz /home/sky/
mv "/home/sky/sky.tar.gz" "$backupPath"

notify-send "Backup is finished"

# Make dir of all my tiktoks I've saved lmfao
# pushd ~/server/backups/Camera/Camera/
# for f in *.mp4; do
    # file=$(echo $f | grep -v "^$(date +%Y)")
    # sudo cp /home/sky/server/backups/Camera/Camera/$file /home/sky/server/backups/tiktoks/
# done
# popd
